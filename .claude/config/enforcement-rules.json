{
  "$schema": "./enforcement-rules.schema.json",
  "version": "2.0.0",
  "description": "Protocol enforcement rules for Claude Code",
  
  "enforcement": {
    "enforce_orchestration": true,
    "enforce_agents": true,
    "enforce_plan_mode": true,
    "enforce_quality_gates": true,
    "strict_mode": false
  },
  
  "thresholds": {
    "complexity_threshold": 3,
    "orchestrator_required_score": 3,
    "agent_suggestion_score": 2
  },
  
  "collaboration_phrases": [
    "can we", "let's", "how do we", "help me",
    "figure out", "work on", "let me know",
    "what if we", "should we", "i want to",
    "i need to", "we need to", "we should"
  ],
  
  "planning_phrases": [
    "plan", "design", "architect", "approach",
    "strategy", "how should", "best way to",
    "propose", "recommend"
  ],
  
  "complexity_indicators": [
    "and then", "after that", "multiple", "several",
    "across", "entire", "all the", "whole",
    "every", "step by step"
  ],
  
  "domain_detection": {
    "security": {
      "patterns": ["auth", "password", "token", "credential", "encrypt", "vulnerability", "security", "permission"],
      "agent": "security-scanner",
      "required": true,
      "plan_mode_first": true
    },
    "architecture": {
      "patterns": ["architect", "design", "refactor", "restructure", "pattern", "modular", "decouple"],
      "agent": "architect",
      "required": true,
      "plan_mode_first": true
    },
    "testing": {
      "patterns": ["test", "spec", "coverage", "tdd", "unit test", "integration test"],
      "agent": "tester",
      "required": false,
      "plan_mode_first": false
    },
    "performance": {
      "patterns": ["performance", "optimize", "slow", "fast", "cache", "memory", "bottleneck"],
      "agent": "performance-analyzer",
      "required": false,
      "plan_mode_first": true
    },
    "frontend": {
      "patterns": ["ui", "component", "layout", "css", "react", "vue", "frontend"],
      "agent": "frontend-designer",
      "required": false,
      "plan_mode_first": false
    },
    "database": {
      "patterns": ["database", "schema", "migration", "model", "query", "sql"],
      "agent": "data-modeler",
      "required": false,
      "plan_mode_first": true
    },
    "api": {
      "patterns": ["api", "endpoint", "rest", "graphql", "route", "controller"],
      "agent": "api-designer",
      "required": false,
      "plan_mode_first": false
    },
    "devops": {
      "patterns": ["docker", "kubernetes", "deploy", "ci", "cd", "pipeline", "infrastructure"],
      "agent": "devops-engineer",
      "required": false,
      "plan_mode_first": true
    }
  },
  
  "subagent_rules": [
    {
      "parent": "security-scanner",
      "spawn": "dependency-auditor",
      "when": "package_files_present"
    },
    {
      "parent": "architect",
      "spawn": "codebase-analyzer",
      "when": "scope == project"
    },
    {
      "parent": "tester",
      "spawn": "test-coverage-enforcer",
      "when": "complexity >= 4"
    }
  ],
  
  "quality_gates": {
    "required_hooks": [
      "laziness-check",
      "honesty-check"
    ],
    "required_for_complexity": 3,
    "block_on_skip": true
  },
  
  "bypass_phrases": [
    "just", "quickly", "simple", "only",
    "skip enforcement", "bypass", "no orchestration"
  ],
  
  "logging": {
    "log_all_prompts": true,
    "log_violations": true,
    "log_decisions": true,
    "retention_days": 30
  },
  
  "actions": {
    "on_violation": {
      "ORCH_REQUIRED": "inject_guidance",
      "AGENT_REQUIRED": "inject_suggestion",
      "QUALITY_GATE_SKIP": "block",
      "LAZY_PATTERN": "block",
      "HALLUCINATION": "block",
      "NO_PLAN_MODE": "warn"
    }
  }
}
